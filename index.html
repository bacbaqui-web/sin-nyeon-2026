<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë””ìŠ¤ì½”ë“œ ì‚¬ë‘ë°© 2026 ì‹ ë…„íšŒ</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter",
                sans-serif;
            background-color: #f7f9fb;
        }
    </style>
</head>
<body class="p-4 sm:p-8">
<div class="max-w-4xl mx-auto space-y-8">
    <!-- í—¤ë” -->
    <header
        class="bg-white p-6 md:p-8 rounded-2xl shadow-xl border-t-4 border-indigo-600"
    >
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2">
            ğŸ‰ ë””ìŠ¤ì½”ë“œ ì‚¬ë‘ë°© 2026 ì‹ ë…„íšŒ
        </h1>
        <div
            class="space-y-4 bg-indigo-50 p-4 rounded-xl border border-indigo-200"
        >
            <ul class="list-none text-gray-700 space-y-2 text-base">
                <li>
                    <span class="font-bold text-indigo-800">ğŸ—“ï¸ ì¼ì‹œ:</span>
                    2026ë…„ 1ì›” 3ì¼ (í† ) ì €ë… 7ì‹œ ~ 1ì›” 4ì¼ ì•„ì¹¨ 9ì‹œ
                </li>
                <li>
                    <span class="font-bold text-indigo-800">ğŸ’° ì°¸ê°€ë¹„:</span>
                    30,000ì›
                </li>
                <li>
                    <span class="font-bold text-indigo-800">ğŸ“ ë¬¸ì˜:</span>
                    ë°•ë°”í€´(ë°•ë³‘ìš±) (010-5140-4640)
                </li>
            </ul>
        </div>
    </header>

    <!-- ì§€ë„ ì„¹ì…˜ -->
    <section class="bg-white p-6 rounded-2xl shadow-lg">
        <h2
            class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2"
        >
            ğŸ“ íŒŒí‹° ì¥ì†Œ: ê°ì„± ê²Œì„íŒŒí‹°ë£¸ ëª¨ê¼¬ì§€ ê°•ë‚¨ì 
        </h2>

        <div
            class="aspect-video overflow-hidden rounded-xl shadow-md mb-4 flex items-center justify-center bg-gray-100"
        >
            <img
                id="map-image"
                src="https://firebasestorage.googleapis.com/v0/b/sin-nyeon-2026.firebasestorage.app/o/1763996729377_clipboard-image.jpg?alt=media&token=75ea6689-63bb-4f95-8654-e7feaf5bcca5"
                alt="ê°ì„± ê²Œì„íŒŒí‹°ë£¸ ëª¨ê¼¬ì§€ ê°•ë‚¨ì  ìœ„ì¹˜ ì´ë¯¸ì§€"
                onerror="this.onerror=null; this.src='https://placehold.co/800x400/4F46E5/ffffff?text=Map+Image+Load+Failed';"
                class="w-full h-auto object-cover rounded-xl"
            />
        </div>

        <div
            class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mt-5"
        >
            <a
                href="#"
                id="naver-map-btn"
                target="_blank"
                class="flex-1 text-center px-4 py-3 border border-transparent text-base font-medium rounded-lg shadow-md text-white bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition"
            >
                ë„¤ì´ë²„ ì§€ë„
            </a>
            <a
                href="#"
                id="kakao-map-btn"
                target="_blank"
                class="flex-1 text-center px-4 py-3 border border-transparent text-base font-medium rounded-lg shadow-md text-gray-900 bg-yellow-400 hover:bg-yellow-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-400 transition"
            >
                ì¹´ì¹´ì˜¤ ë§µ
            </a>
        </div>
    </section>

    <!-- ì°¸ê°€ ì‹ ì²­ í¼ -->
    <section class="bg-white p-6 rounded-2xl shadow-lg">
        <h2
            class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2"
        >
            ğŸ“ ì°¸ê°€ ì‹ ì²­
        </h2>
        <form onsubmit="handleFormSubmit(event)" class="space-y-4">
            <div>
                <label
                    for="name"
                    class="block text-sm font-medium text-gray-700"
                >
                    í•„ëª… / ì‘í’ˆ <span class="text-red-500">*</span>
                </label>
                <input
                    type="text"
                    id="name"
                    name="name"
                    required
                    class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-3 border"
                    placeholder="ì‚¼ë‘ê¸° / ìŠˆí¼ë³‘ì‹ ì•„ì¹´ë°ë¯¸ì•„"
                    maxlength="70"
                />
            </div>
            <button
                type="submit"
                id="submit-btn"
                class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-300"
            >
                ì°¸ê°€ ì‹ ì²­í•˜ê¸°
            </button>
        </form>
    </section>

    <!-- ì°¸ê°€ì ëª©ë¡ -->
    <section class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <div class="p-6 bg-indigo-50 border-b border-indigo-200">
            <h2
                class="text-2xl font-bold text-gray-800 flex items-baseline space-x-1"
            >
                <span>ì°¸ê°€ì ëª…ë‹¨</span>
                <span
                    id="participant-count"
                    class="text-indigo-600 text-3xl font-extrabold"
                    >0</span
                >
                <span>ëª…</span>
            </h2>
        </div>
        <div
            id="participant-list"
            class="divide-y divide-gray-100"
        >
            <div class="text-center p-8 text-gray-400">
                ì°¸ê°€ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
        </div>
    </section>

    <!-- í† ìŠ¤íŠ¸ -->
    <div
        id="toast-message"
        class="fixed bottom-5 left-1/2 -translate-x-1/2 p-3 rounded-xl text-white shadow-lg z-50 transition-opacity duration-300 opacity-0 border-b-4"
    >
        í† ìŠ¤íŠ¸ ë©”ì‹œì§€
    </div>

    <!-- ì‚­ì œ ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
    <div
        id="password-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
    >
        <div
            class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm space-y-4"
        >
            <h3 class="text-lg font-bold text-gray-800">
                ì°¸ê°€ì ì‚­ì œ í™•ì¸
            </h3>
            <p class="text-sm font-bold text-gray-700">ë¹„ë°€ë²ˆí˜¸</p>
            <input
                type="password"
                id="delete-password"
                placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
                class="w-full p-3 border rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
            />
            <div class="flex justify-end space-x-3">
                <button
                    onclick="closePasswordModal()"
                    class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300"
                >
                    ì·¨ì†Œ
                </button>
                <button
                    onclick="checkPassword()"
                    id="confirm-delete-btn"
                    class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 disabled:opacity-50"
                >
                    ì‚­ì œ í™•ì¸
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Firebase ë° ì•± ìŠ¤í¬ë¦½íŠ¸ -->
<script type="module">
    // ------------------------------
    // Firebase SDK import (ëª¨ë“ˆ CDN)
    // ------------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
        getAuth,
        signInAnonymously,
        onAuthStateChanged,
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import {
        getFirestore,
        collection,
        addDoc,
        query,
        orderBy,
        onSnapshot,
        serverTimestamp,
        doc,
        deleteDoc,
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // ------------------------------
    // Firebase ì„¤ì • (ì§ˆë¬¸ì—ì„œ ì£¼ì‹  ê°’)
    // ------------------------------
    const firebaseConfig = {
        apiKey: "AIzaSyBKdlRRmjuZbrARI0_eoFa8KMsnSIpqlNw",
        authDomain: "sin-nyeon-2026.firebaseapp.com",
        projectId: "sin-nyeon-2026",
        storageBucket: "sin-nyeon-2026.firebasestorage.app",
        messagingSenderId: "376174106968",
        appId: "1:376174106968:web:5c169c819724a4f4982d2d",
        measurementId: "G-RF6CT40D5S",
    };

    // ì°¸ê°€ì ì»¬ë ‰ì…˜ ì´ë¦„ (ì›í•˜ì‹œë©´ ì—¬ê¸°ë§Œ ë°”ê¾¸ì‹œë©´ ë©ë‹ˆë‹¤)
    const PARTICIPANT_COLLECTION = "participants";

    // ------------------------------
    // ì „ì—­ ìƒíƒœ
    // ------------------------------
    let db;
    let auth;
    let userId = "anonymous";
    let participantToDeleteId = null;

    // ì§€ë„ ë²„íŠ¼ ì„¸íŒ…
    function setupMapButtons() {
        const searchName = "ê°ì„± ê²Œì„íŒŒí‹°ë£¸ ëª¨ê¼¬ì§€ ê°•ë‚¨ì ";
        const encodedName = encodeURIComponent(searchName);

        const naverBtn = document.getElementById("naver-map-btn");
        const kakaoBtn = document.getElementById("kakao-map-btn");

        const kakaoPlaceUrl =
            "https://place.map.kakao.com/1670851940";

        if (naverBtn) {
            naverBtn.href = `https://map.naver.com/v5/search/${encodedName}`;
        }
        if (kakaoBtn) {
            kakaoBtn.href = kakaoPlaceUrl;
        }
    }

    // í† ìŠ¤íŠ¸
    function showToast(message, type) {
        const toast = document.getElementById("toast-message");
        toast.textContent = message;

        const successStyle = "bg-green-500 border-green-700";
        const errorStyle = "bg-red-500 border-red-700";

        toast.className = `fixed bottom-5 left-1/2 -translate-x-1/2 p-3 rounded-xl text-white shadow-lg z-50 transition-opacity duration-300 opacity-0 border-b-4 ${
            type === "success" ? successStyle : errorStyle
        }`;

        setTimeout(() => {
            toast.classList.remove("opacity-0");
            toast.classList.add("opacity-100");
        }, 10);

        setTimeout(() => {
            toast.classList.remove("opacity-100");
            toast.classList.add("opacity-0");
        }, 3000);
    }

    // ì°¸ê°€ì ëª©ë¡ ë Œë”
    function renderParticipants(participants) {
        const listContainer =
            document.getElementById("participant-list");
        const countEl = document.getElementById("participant-count");

        listContainer.innerHTML = "";
        countEl.textContent = participants.length;

        if (participants.length === 0) {
            listContainer.innerHTML = `
                <p class="text-gray-500 text-center py-4 bg-gray-50 rounded-lg">
                    ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ë¡œ ë“±ë¡í•´ ë³´ì„¸ìš”!
                </p>
            `;
            return;
        }

        participants.forEach((p, index) => {
            const item = document.createElement("div");
            item.className =
                "flex justify-between items-center p-4 bg-white border-b border-gray-100 last:border-b-0 transition duration-300 hover:bg-indigo-50/50";

            item.innerHTML = `
                <div class="flex items-center space-x-4 flex-1">
                    <span class="font-bold text-indigo-600 text-lg w-6 text-center">${
                        index + 1
                    }</span>
                    <div>
                        <p class="font-semibold text-gray-800">${p.name}</p>
                    </div>
                </div>
                <button onclick="requestDelete('${
                    p.id
                }')"
                        class="text-red-500 hover:text-red-700 p-2 rounded-full transition duration-150 flex-shrink-0"
                        title="ì°¸ê°€ì ì‚­ì œ">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                         xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;

            listContainer.appendChild(item);
        });
    }

    // ì°¸ê°€ì ëª©ë¡ ë¡œë“œ (ì‹¤ì‹œê°„)
    function loadParticipants() {
        if (!db) return;

        const participantsColRef = collection(
            db,
            PARTICIPANT_COLLECTION
        );
        const q = query(
            participantsColRef,
            orderBy("timestamp", "desc")
        );

        onSnapshot(
            q,
            (snapshot) => {
                const participants = [];
                snapshot.forEach((d) => {
                    const data = d.data();
                    participants.push({
                        id: d.id,
                        ...data,
                    });
                });
                renderParticipants(participants);
            },
            (error) => {
                console.error(
                    "ì°¸ê°€ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:",
                    error
                );
                document.getElementById(
                    "participant-list"
                ).innerHTML = `<p class="text-red-500 p-4">ì°¸ê°€ì ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì˜¤ë¥˜: ${error.message}</p>`;
            }
        );
    }

    // í¼ ì œì¶œ í•¸ë“¤ëŸ¬ (ì „ì—­)
    window.handleFormSubmit = async function (event) {
        event.preventDefault();

        const nameInput = document.getElementById("name");
        const submitButton = document.getElementById("submit-btn");
        const name = nameInput.value.trim();

        if (!name) {
            showToast(
                "í•„ëª… / ì‘í’ˆì€ í•„ìˆ˜ ì…ë ¥ ì‚¬í•­ì…ë‹ˆë‹¤.",
                "error"
            );
            return;
        }

        if (!db) {
            showToast(
                "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
                "error"
            );
            console.error("dbê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            return;
        }

        submitButton.disabled = true;
        submitButton.textContent = "ë“±ë¡ ì¤‘...";

        try {
            const participantsColRef = collection(
                db,
                PARTICIPANT_COLLECTION
            );
            await addDoc(participantsColRef, {
                name,
                registeredBy: userId,
                timestamp: serverTimestamp(),
            });

            showToast("ì°¸ê°€ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
            nameInput.value = "";
        } catch (e) {
            console.error("ì°¸ê°€ ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
            showToast(`ì‹ ì²­ ì˜¤ë¥˜: ${e.message}`, "error");
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = "ì°¸ê°€ ì‹ ì²­í•˜ê¸°";
        }
    };

    // ì‚­ì œ ìš”ì²­
    window.requestDelete = function (participantId) {
        if (!db) {
            showToast(
                "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.",
                "error"
            );
            console.error("dbê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            return;
        }
        participantToDeleteId = participantId;
        document
            .getElementById("password-modal")
            .classList.remove("hidden");
        const pwInput =
            document.getElementById("delete-password");
        pwInput.value = "";
        pwInput.focus();
    };

    // ëª¨ë‹¬ ë‹«ê¸°
    window.closePasswordModal = function () {
        document
            .getElementById("password-modal")
            .classList.add("hidden");
        participantToDeleteId = null;
    };

    // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í›„ ì‚­ì œ
    window.checkPassword = async function () {
        const passwordInput =
            document.getElementById("delete-password");
        const password = passwordInput.value.trim();
        const confirmBtn =
            document.getElementById("confirm-delete-btn");
        const PASSWORD_CODE = "1234";

        if (password !== PASSWORD_CODE) {
            showToast(
                "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
                "error"
            );
            passwordInput.value = "";
            passwordInput.focus();
            return;
        }

        if (!participantToDeleteId) {
            showToast(
                "ì‚­ì œí•  ì°¸ê°€ìê°€ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.",
                "error"
            );
            window.closePasswordModal();
            return;
        }

        confirmBtn.disabled = true;
        confirmBtn.textContent = "ì‚­ì œ ì¤‘...";

        try {
            const docRef = doc(
                db,
                PARTICIPANT_COLLECTION,
                participantToDeleteId
            );
            await deleteDoc(docRef);

            showToast(
                "ì°¸ê°€ìê°€ ëª…ë‹¨ì—ì„œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",
                "success"
            );
            window.closePasswordModal();
        } catch (e) {
            console.error("ì°¸ê°€ì ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e);
            showToast(`ì‚­ì œ ì˜¤ë¥˜: ${e.message}`, "error");
        } finally {
            confirmBtn.disabled = false;
            confirmBtn.textContent = "ì‚­ì œ í™•ì¸";
            participantToDeleteId = null;
        }
    };

    // Firebase ì´ˆê¸°í™”
    async function initFirebase() {
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            await signInAnonymously(auth);

            onAuthStateChanged(auth, (user) => {
                if (user) {
                    userId = user.uid;
                    console.log(
                        "Firebase ì¸ì¦ ì„±ê³µ, User ID:",
                        userId
                    );
                    loadParticipants();
                } else {
                    console.log("ì¸ì¦ë˜ì§€ ì•ŠìŒ");
                }
            });
        } catch (e) {
            console.error("Firebase ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:", e);
            showToast(
                "Firebase ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
                "error"
            );
        }
    }

    // ì´ˆê¸° ì‹¤í–‰
    setupMapButtons();
    initFirebase();
</script>
</body>
</html>
